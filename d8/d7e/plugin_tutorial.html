<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DeaDBeeF: Plugin Tutorial</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../deadbeef.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DeaDBeeF
   &#160;<span id="projectnumber">1.8-based</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>DeaDBeeF supports external plugins which uses DeaDBeeF API calls. In this tutorial you will learn how to use it. This tutorial will use C language and linux platform.</p>
<p>Plugins are compiled as shared library. They are loaded dynamically on runtime. In next section you will learn what each plugin needs to do.</p>
<p>To access deadbeef definitions include deadbeef header file: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d6e/deadbeef_8h.html">deadbeef/deadbeef.h</a>&gt;</span></div></div><!-- fragment --><h1><a class="anchor" id="plugin_header"></a>
Plugin header</h1>
<p>Each plugin needs a header. It contains basic information as plugin name, author and pointers to your plugin functions. For more information see <a class="el" href="../../d6/d6e/deadbeef_8h.html#a2cd03cd142d7ca42ecfcb65b1668162b">DB_plugin_t</a>. It's not defined directly however. It is encapsulated inside plugin structure. There are different headers for different plugin types:</p><ul>
<li><a class="el" href="../../d6/d6e/deadbeef_8h.html#ad25b8eba295d7cccdadf3b7c85142706">DB_dsp_t</a> - DSP plugin</li>
<li><a class="el" href="../../d6/d6e/deadbeef_8h.html#a4d3b0559f9ea5a7b7f36c0887b2b4afd">DB_gui_t</a> - GUI plugin</li>
<li><a class="el" href="../../de/d4d/struct_d_b__misc__t.html">DB_misc_t</a> - Misc plugin</li>
<li><a class="el" href="../../d6/d6e/deadbeef_8h.html#a317afa68c3e44331a389ebb0faef6179">DB_output_t</a> - Output plugin</li>
<li><a class="el" href="../../d6/d6e/deadbeef_8h.html#a1548423df16650b090ffc1216887704b">DB_playlist_t</a> - playlist plugin</li>
<li><a class="el" href="../../d6/d6e/deadbeef_8h.html#acb1e3e87609004fd1c299a44536a3407">DB_vfs_t</a> - vfs (virtual file system) plugin</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Plugin type ending <code>_t</code> mean that these are typedef types. Typedef <a class="el" href="../../d6/d6e/deadbeef_8h.html#a317afa68c3e44331a389ebb0faef6179">DB_output_t</a> is equivalent to <code>struct</code> <a class="el" href="../../db/df3/struct_d_b__output__s.html">DB_output_s</a></dd></dl>
<p>Some information about each plugin type can be found at <a href="https://github.com/DeaDBeeF-Player/deadbeef/wiki/Developing-your-own-plugin">https://github.com/DeaDBeeF-Player/deadbeef/wiki/Developing-your-own-plugin</a></p>
<p>Each plugin type includes <a class="el" href="../../d6/d6e/deadbeef_8h.html#a2cd03cd142d7ca42ecfcb65b1668162b">DB_plugin_t</a> header at the beginning; this allows you to cast each plugin pointer as <a class="el" href="../../d6/d6e/deadbeef_8h.html#a2cd03cd142d7ca42ecfcb65b1668162b">DB_plugin_t</a> without any problems! Additionally each plugin type includes type specific functions, except <a class="el" href="../../de/d4d/struct_d_b__misc__t.html">DB_misc_t</a>.</p>
<p>Here is example plugin header for notify plugin: </p><div class="fragment"><div class="line"><a class="code" href="../../de/d4d/struct_d_b__misc__t.html">DB_misc_t</a> plugin = {</div><div class="line">    <a class="code" href="../../d6/d6e/deadbeef_8h.html#a00934c6a283ae13f50d0222c7a3b10a5">DDB_PLUGIN_SET_API_VERSION</a></div><div class="line">    .plugin.type = <a class="code" href="../../d6/d6e/deadbeef_8h.html#adf764cbdea00d65edcd07bb9953ad2b7abc7da8921ab49902696c648d03d28aa6">DB_PLUGIN_MISC</a>,</div><div class="line">    .plugin.version_major = 1,</div><div class="line">    .plugin.version_minor = 0,</div><div class="line">    .plugin.id = <span class="stringliteral">&quot;notify&quot;</span>,</div><div class="line">    .plugin.name = <span class="stringliteral">&quot;OSD Notify&quot;</span>,</div><div class="line">    .plugin.descr = <span class="stringliteral">&quot;Displays notifications when new track starts.\nRequires dbus and notification daemon to be running.\nNotification daemon should be provided by your desktop environment.\n&quot;</span>,</div><div class="line">    .plugin.copyright = </div><div class="line">        <span class="stringliteral">&quot;OSD Notification plugin for DeaDBeeF Player\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;Copyright (C) 2009-2014 Alexey Yakovenko and contributors\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;This program is free software; you can redistribute it and/or\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;modify it under the terms of the GNU General Public License\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;as published by the Free Software Foundation; either version 2\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;of the License, or (at your option) any later version.\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;This program is distributed in the hope that it will be useful,\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;but WITHOUT ANY WARRANTY; without even the implied warranty of\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;GNU General Public License for more details.\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;You should have received a copy of the GNU General Public License\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;along with this program; if not, write to the Free Software\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n&quot;</span></div><div class="line">    ,</div><div class="line">    .plugin.website = <span class="stringliteral">&quot;http://deadbeef.sourceforge.net&quot;</span>,</div><div class="line">    .plugin.start = notify_start,</div><div class="line">    .plugin.stop = notify_stop,</div><div class="line">    .plugin.connect = notify_connect,</div><div class="line">    .plugin.disconnect = notify_disconnect,</div><div class="line">    .plugin.configdialog = settings_dlg,</div><div class="line">    .plugin.message = notify_message,</div><div class="line">};</div></div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>In above example <a class="el" href="../../d6/d6e/deadbeef_8h.html#a00934c6a283ae13f50d0222c7a3b10a5">DDB_PLUGIN_SET_API_VERSION</a> macro is used. This macro sets <code>.plugin.api_vmajor</code> and <code>.plugin.api_vminor</code> to header API version. </dd>
<dd>
<b>DON'T USE IT IN OWN WRITTEN PLUGINS!</b> Define <code>.plugin.api_vmajor</code> and <code>.plugin.api_vminor</code> manually to the most recent API version at time of writing.</dd></dl>
<h1><a class="anchor" id="dlopen"></a>
Dynamic loading of plugin</h1>
<p>When deadbeef starts, your plugin will be dlopened. DeaDBeeF will look for <code>PLUG_NAME_load</code> function, where <code>PLUG_NAME</code> is the plugin filename (without suffix of course). Let us see how it looks for plugin notify: </p><div class="fragment"><div class="line"><a class="code" href="../../de/da4/struct_d_b__plugin__s.html">DB_plugin_t</a> *</div><div class="line">notify_load (<a class="code" href="../../d9/dbc/struct_d_b__functions__t.html">DB_functions_t</a> *ddb) {</div><div class="line">    deadbeef = ddb;</div><div class="line">    <span class="keywordflow">return</span> &amp;plugin.<a class="code" href="../../de/d4d/struct_d_b__misc__t.html#a5871f24ff8111fccd927a640c3f88200">plugin</a>;</div><div class="line">}</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Instead of returning <code>&amp;plugin.plugin</code> you can return <code><a class="el" href="../../d6/d6e/deadbeef_8h.html#ad1768f6c0da50867f711b8d21743529c">DB_PLUGIN(&amp;plugin)</a>;</code>. In practice returned adress will be the same for both cases.</dd></dl>
<p><code>notify_load</code> is called with <a class="el" href="../../d9/dbc/struct_d_b__functions__t.html">DB_functions_t</a> *ddb argument. With this pointer you can call player functions. In this example it will be stored in <code>deadbeef</code> which is allocated as global variable. Function returns pointer to our plugin header.</p>
<h1><a class="anchor" id="compile"></a>
Compiling</h1>
<p>You need to compile your plugin as shared library. Something like this should be enough (if you placed deadbeef header in dir gcc can find): </p><div class="fragment"><div class="line">gcc -std=c99 -shared -O2 -o myplugin.so myplugin.c</div></div><!-- fragment --><p> Code below is the Makefile I use. Feel free to use it. </p><div class="fragment"><div class="line">CC=gcc</div><div class="line">STD=gnu99</div><div class="line">CFLAGS=-fPIC -I /usr/local/include -Wall</div><div class="line">ifeq ($(DEBUG),1)</div><div class="line">CFLAGS +=-g -O0</div><div class="line">endif</div><div class="line"></div><div class="line">PREFIX=/usr/local/lib/deadbeef</div><div class="line">PLUGNAME=example</div><div class="line">LIBS=</div><div class="line"></div><div class="line">all:</div><div class="line">    $(CC) -std=$(STD) -c $(CFLAGS) -c $(PLUGNAME).c</div><div class="line">    $(CC) -std=$(STD) -shared $(CFLAGS) -o $(PLUGNAME).so $(PLUGNAME).o $(LIBS)</div><div class="line"></div><div class="line">install:</div><div class="line">    cp $(PLUGNAME).$(SUFFIX) $(PREFIX)</div><div class="line"></div><div class="line">clean:</div><div class="line">    rm -fv $(PLUGNAME).o $(PLUGNAME).$(SUFFIX)</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
